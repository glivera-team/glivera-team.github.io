---
layout: post
title:  "Разработка темы wordpress - Принудительное обновление js и css-файлов"
date:   2017-12-26
categories: wordpress
lang: ru
autor:  glivera-team
---

## Принудительное обновление js и css-файлов

При первом заходе пользователя на сайт, браузер сохраняет js и css-файлы в кеш. При повторном посещение этого сайта закешированные файлы не запрашиваются с сервера. Обновление файлов кеша происходит с определенной периодичностью, заданной в настройках сервера и этот интервал никак не связан с изменениями самих файлов. И если файлы обновились на сервере, то в кеше браузера пользователя они автоматически не обновляются, и пользователь все еще будет видет предыдущую версию файлов, пока не произойдет обновление или пока пользователь сам не почистит кеш.

Исправить ситуацию можно добавлением версии к имени файла при каждом его изменении, например так:

```php
wp_register_script( 'main',  get_template_directory_uri() . '/js/main.js', array(), '1.0.0', true );
```

Но каждый раз изменять версию файла вручную довольно таки занудное занятие, или можно просто банально забыть это сделать.

Автоматизировать этот процесс можно, с помощью php-функции ``hash_file()``. Она возвращает строку, содержащую вычисленный хеш-код в шестнадцатеричной кодировке в нижнем регистре:

```php
wp_register_script( 'main',  get_template_directory_uri() . '/js/main.js', array(), hash_file( ‘crc32’, get_template_directory_uri() . '/js/main.js' ), true );
```

В результате получим: ``/js/main.js?ver=4e785666``

Каждый раз при сохранении изменений в файле для него будет генерироваться новый хеш-код.
